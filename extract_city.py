# extract_city.py - Функция для извлечения города из адреса

def extract_city(address: str) -> str:
    """Извлечь город из адреса"""
    if not address:
        return "Не указано"
    
    address_lower = address.lower()
    
    # Список городов России для определения
    city_keywords = {
        "москва": ["москв", "moscow"],
        "санкт-петербург": ["санкт-петербург", "спб", "питер", "st petersburg", "saint petersburg"],
        "казань": ["казан"],
        "екатеринбург": ["екатеринбург", "екб"],
        "новосибирск": ["новосибирск"],
        "нижний новгород": ["нижний новгород", "нижний"],
        "самара": ["самар"],
        "омск": ["омск"],
        "челябинск": ["челябинск"],
        "ростов-на-дону": ["ростов-на-дону", "ростов"],
        "уфа": ["уфа"],
        "красноярск": ["красноярск"],
        "пермь": ["перм"],
        "воронеж": ["воронеж"],
        "волгоград": ["волгоград"],
        "краснодар": ["краснодар"],
        "саратов": ["саратов"],
        "тюмень": ["тюмен"],
        "тольятти": ["тольятти"],
        "ижевск": ["ижевск"],
        "барнаул": ["барнаул"],
        "ульяновск": ["ульяновск"],
        "иркутск": ["иркутск"],
        "хабаровск": ["хабаровск"],
        "ярославль": ["ярослав"],
        "владивосток": ["владивосток"],
        "махачкала": ["махачкала"],
        "томск": ["томск"],
        "оренбург": ["оренбург"],
        "кемерово": ["кемерово"],
        "новокузнецк": ["новокузнецк"],
        "рязань": ["рязан"],
        "астрахань": ["астрахан"],
        "пенза": ["пенз"],
        "липецк": ["липецк"],
        "киров": ["киров"],
        "чебоксары": ["чебоксар"],
        "калининград": ["калининград"],
        "тула": ["тул"],
        "курск": ["курск"],
        "сочи": ["сочи"],
        "ставрополь": ["ставропол"],
        "магнитогорск": ["магнитогорск"],
        "брянск": ["брянск"],
        "севастополь": ["севастопол"],
        "нижний тагил": ["нижний тагил"],
        "дзержинск": ["дзержинск"],
        "орск": ["орск"],
        "сургут": ["сургут"]
    }
    
    for city, keywords in city_keywords.items():
        for keyword in keywords:
            if keyword in address_lower:
                return city
    
    # Если город не найден, берем первую часть до запятой
    if ',' in address:
        return address.split(',')[0].strip()
    
    # Или ограничиваем длину
    return address[:30] if len(address) > 30 else address